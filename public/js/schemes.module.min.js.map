{"version":3,"file":"schemes.module.min.js","sources":["../../src/core/generated/scripts/config.js","../../src/core/api.js","../../src/schemes/scripts/scheme/constants.js","../../src/schemes/scripts/scheme/scheme.js","../../src/schemes/index.js","../../src/schemes/scripts/switch-theme/constants.js","../../src/schemes/scripts/switch-theme/switch-theme.js","../../src/schemes/scripts/module.js","../../src/schemes/scripts/scheme/build.js","../../src/schemes/scripts/switch-theme/build.js"],"sourcesContent":["export const prefix = 'fr';\r\nexport const namespace = 'dsfr';\r\nexport const organisation = '@gouvfr';\r\n","import { namespace } from './generated/scripts/config.js';\n\nconst api = window[namespace] || { core: {} };\nwindow[namespace] = api;\nexport default api;\n","import api from '../../api.js';\n\nexport const SCHEME_ATTR = api.core.ns.attr('theme');\nexport const TRANSITION_ATTR = api.core.ns.attr('transition');\n","import { SCHEME_ATTR, TRANSITION_ATTR } from './constants';\n\n/**\n * TODO: implÃ©menter la valeur system\n * window.matchMedia(\"(prefers-color-scheme: dark)\").addListener(\n e => e.matches && activateDarkMode()) // listener\n );\n */\n\nclass Scheme {\n  constructor () {\n    this.init();\n  }\n\n  init () {\n    this.root = document.documentElement;\n\n    this.scheme = localStorage.getItem('scheme')\n      ? localStorage.getItem('scheme')\n      : null;\n\n    if (this.scheme === null) {\n      const scheme = this.root.getAttribute(SCHEME_ATTR);\n      if (scheme === 'dark' || scheme === 'light') {\n        this.scheme = scheme;\n      } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {\n        this.scheme = 'dark';\n        localStorage.setItem('scheme', 'dark');\n      } else this.scheme = 'light';\n    }\n\n    if (this.scheme === 'dark') {\n      if (!this.root.hasAttribute(TRANSITION_ATTR)) {\n        this.root.setAttribute(SCHEME_ATTR, 'dark');\n      } else {\n        this.root.removeAttribute(TRANSITION_ATTR);\n        this.root.setAttribute(SCHEME_ATTR, 'dark');\n\n        setTimeout(() => {\n          this.root.setAttribute(TRANSITION_ATTR, '');\n        }, 300);\n      }\n    } else this.root.setAttribute(SCHEME_ATTR, 'light');\n\n    this.observer = new MutationObserver(this.mutate.bind(this));\n    this.observer.observe(this.root, { attributes: true });\n  }\n\n  mutate (mutations) {\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'attributes' && mutation.attributeName === SCHEME_ATTR) {\n        const scheme = this.root.getAttribute(SCHEME_ATTR);\n        if (scheme === 'dark') {\n          localStorage.setItem('scheme', 'dark');\n        } else if (scheme === 'light') {\n          localStorage.setItem('scheme', 'light');\n        }\n      }\n    });\n  }\n}\n\nexport { Scheme };\n","import api from './api.js';\nimport { Scheme } from './scripts/scheme/scheme';\n\napi.Scheme = Scheme;\n","import api from '../../api.js';\n\nexport const RADIOS_THEME_NAME = `input[name=\"${api.core.ns.selector('radios-theme', '')}\"]`;\nexport const SWITCH_THEME_ID = api.core.ns.selector('switch-theme', '#');\nexport const THEME_ATTR = api.core.ns.attr('theme');\n","import { RADIOS_THEME_NAME, THEME_ATTR } from './constants';\n\nclass SwitchTheme {\n  constructor () {\n    this.attributeName = THEME_ATTR;\n    this.theme = null;\n    this.radios = document.querySelectorAll(RADIOS_THEME_NAME);\n\n    for (var i = 0; i < this.radios.length; i++) {\n      this.radios[i].addEventListener('change', this.change.bind(this));\n    }\n\n    this.observer = new MutationObserver(this.mutate.bind(this));\n    this.observe();\n    this.apply();\n  }\n\n  observe () {\n    this.observer.observe(document.documentElement, { attributes: true });\n  }\n\n  mutate (mutations) {\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'attributes' && mutation.attributeName === this.attributeName) {\n        this.apply();\n      }\n    });\n  }\n\n  apply () {\n    const theme = document.documentElement.getAttribute(this.attributeName);\n    this.isApplying = true;\n    for (var i = 0; i < this.radios.length; i++) {\n      this.radios[i].checked = this.radios[i].value === theme;\n    }\n    this.isApplying = false;\n  }\n\n  change () {\n    if (this.isApplying) return;\n    if (this.observer) this.observer.disconnect();\n    this.theme = document.querySelector(RADIOS_THEME_NAME + ':checked');\n    if (this.theme) {\n      document.documentElement.setAttribute(this.attributeName, this.theme.value);\n    } else {\n      document.documentElement.removeAttribute(this.attributeName);\n    }\n    if (this.observer) this.observe();\n  }\n}\n\nexport { SwitchTheme };\n","/* eslint-disable no-new */\nimport api from '../api.js';\nimport { SCHEME_ATTR } from './scheme/constants';\nimport { SWITCH_THEME_ID } from './switch-theme/constants';\nimport buildScheme from './scheme/build';\nimport buildSwitch from './switch-theme/build';\n\nnew api.core.Initializer(`:root[${SCHEME_ATTR}]`, [buildScheme]);\nnew api.core.Initializer(`${SWITCH_THEME_ID}`, [buildSwitch]);\n","/* eslint-disable no-new */\nimport { Scheme } from './scheme';\n\nconst build = () => {\n  new Scheme();\n};\n\nexport default build;\n","/* eslint-disable no-new */\nimport { SwitchTheme } from './switch-theme';\n\nconst build = () => {\n  new SwitchTheme();\n};\n\nexport default build;\n"],"names":["api","window","core","SCHEME_ATTR","ns","attr","TRANSITION_ATTR","Scheme","[object Object]","this","init","root","document","documentElement","scheme","localStorage","getItem","getAttribute","matchMedia","matches","setItem","hasAttribute","removeAttribute","setAttribute","setTimeout","observer","MutationObserver","mutate","bind","observe","attributes","mutations","forEach","mutation","type","attributeName","RADIOS_THEME_NAME","selector","SWITCH_THEME_ID","THEME_ATTR","SwitchTheme","theme","radios","querySelectorAll","i","length","addEventListener","change","apply","isApplying","checked","value","disconnect","querySelector","Initializer"],"mappings":"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"}